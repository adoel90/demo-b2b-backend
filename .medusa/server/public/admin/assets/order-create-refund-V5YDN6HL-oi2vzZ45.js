import{a as L}from"./chunk-EA4G7XL6-DPYHAc9l.js";import{f as T}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{f as I}from"./chunk-OV5NMSY6-CzJZ0JaW.js";import{D as A}from"./chunk-7I5DQGWY-CwOWioty.js";import{g as N}from"./chunk-PDWBYQOW-Dmlh1vBq.js";import{c as V}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{K as w}from"./chunk-6HTZNHPT-DYv5rdOA.js";import{b as l,u as D}from"./chunk-4TC5YS65-DXocPEx1.js";import{b as F,$ as M,b6 as z,dc as O,j as e,H as $,u as B,ab as H,r as _,aj as k,ak as q,t as v,ac as u,E as K,x as a,d8 as U,cx as G,y as J,B as C,ad as Q,af as g,aq as W}from"./index-BgVe_0kv.js";import{a as X}from"./chunk-FO3VP56P-CVOrSn0A.js";import"./chunk-7DXVXBSA-u0lQbI_F.js";import"./arrow-down-right-mini-DZ-oO4wh.js";import"./Trans-eID9gRRa.js";var Y=Q({amount:g().or(W()),refund_reason_id:g().nullish(),note:g().optional()}),Z=({order:t,refundReasons:y})=>{const{t:n}=F(),{handleSuccess:m}=D(),h=B(),[j]=H(),p=j.get("paymentId"),b=L(t),r=b.find(s=>s.id===p),R=(r==null?void 0:r.amount)||0,f=_.useMemo(()=>V[t.currency_code.toUpperCase()],[t.currency_code]),c=k({defaultValues:{amount:R,note:""},resolver:q(Y)});_.useEffect(()=>{const s=t.summary.pending_difference,o=(r==null?void 0:r.amount)||0,d=s<0?Math.min(s,o):o,x=d<0?d*-1:d;c.setValue("amount",x)},[r]);const{mutateAsync:S,isPending:E}=X(t.id,r==null?void 0:r.id),P=c.handleSubmit(async s=>{await S({amount:parseFloat(s.amount),refund_reason_id:s.refund_reason_id,note:s.note},{onSuccess:()=>{v.success(n("orders.payment.refundPaymentSuccess",{amount:I(s.amount,r==null?void 0:r.currency_code)})),m()},onError:o=>{v.error(o.message)}})});return e.jsx(l.Form,{form:c,children:e.jsxs(w,{onSubmit:P,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(l.Body,{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(u,{value:r==null?void 0:r.id,onValueChange:s=>{h(`/orders/${t.id}/refund?paymentId=${s}`,{replace:!0})},children:[e.jsx(K,{className:"txt-compact-small mb-[-6px] font-sans font-medium",children:n("orders.payment.selectPaymentToRefund")}),e.jsx(u.Trigger,{children:e.jsx(u.Value,{placeholder:n("orders.payment.selectPaymentToRefund")})}),e.jsx(u.Content,{children:b.map(s=>{const o=s.refunds.reduce((d,x)=>x.amount+d,0);return e.jsxs(u.Item,{value:s.id,disabled:!!s.canceled_at||o>=s.amount,className:"flex items-center justify-center",children:[e.jsxs("span",{children:[N(s.amount,s.currency_code)," - "]}),e.jsx("span",{children:T(s.provider_id)}),e.jsxs("span",{children:[" - (#",s.id.substring(23),")"]})]},s.id)})})]}),e.jsx(a.Field,{control:c.control,name:"amount",rules:{required:!0,min:0,max:R},render:({field:{onChange:s,...o}})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:n("fields.amount")}),e.jsx(a.Control,{children:e.jsx(U,{...o,min:0,placeholder:G({value:"0",decimalScale:f.decimal_digits}),decimalScale:f.decimal_digits,symbol:f.symbol_native,code:f.code,value:o.value,onValueChange:(d,x,i)=>s(i!=null&&i.value?i==null?void 0:i.value:""),autoFocus:!0})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:c.control,name:"note",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:n("fields.note")}),e.jsx(a.Control,{children:e.jsx(J,{...s})}),e.jsx(a.ErrorMessage,{})]})})]})}),e.jsx(l.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(l.Close,{asChild:!0,children:e.jsx(C,{variant:"secondary",size:"small",children:n("actions.cancel")})}),e.jsx(C,{isLoading:E,type:"submit",variant:"primary",size:"small",disabled:!!Object.keys(c.formState.errors||{}).length,children:n("actions.save")})]})})]})})},fe=()=>{const{t}=F(),y=M(),{order:n}=z(y.id,{fields:A}),{refund_reasons:m,isLoading:h,isError:j,error:p}=O();if(j)throw p;return e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsx($,{children:t("orders.payment.createRefund")})}),n&&!h&&m&&e.jsx(Z,{order:n,refundReasons:m})]})};export{fe as Component};
